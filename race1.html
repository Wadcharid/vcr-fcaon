<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Race Predict (Race Pace) Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: inline-block; width: 250px; margin-top: 10px; vertical-align: top; }
    input { margin-top: 10px; }
    button { margin-top: 20px; padding: 5px 15px; }
    .inline-input { margin-bottom: 10px; }
    .inline-input input { width: 60px; }
    .segment-list { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Race Predict (Race Pace) Calculator</h1>
  <form id="raceForm" onsubmit="event.preventDefault(); calculateRacePredict();">
    <div class="inline-input">
      <label for="ltMinutes">LT Pace (นาที/กม.)<br>
        [เร็วที่สุดที่วิ่งได้ต่อเนื่อง 50-60 นาที หรือ 10K]:
      </label>
      <input type="number" id="ltMinutes" name="ltMinutes" min="0" placeholder="นาที" required> :
      <input type="number" id="ltSeconds" name="ltSeconds" min="0" max="59" placeholder="วินาที" required>
    </div>
    <div>
      <label for="distance">ระยะทางที่ต้องการคาดการณ์เวลาที่ทำได้ (กม.):</label>
      <input type="number" id="distance" name="distance" step="any" required>
    </div>
    <button type="submit">คำนวณ</button>
  </form>

  <h2>ผลลัพธ์:</h2>
  <div id="result"></div>
  <div id="breakdown"></div>

  <script>
    // ฟังก์ชันแปลงเวลา (วินาที) ให้เป็น "ชั่วโมง นาที วินาที"
    function formatTime(totalSeconds) {
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      let timeString = "";
      if (hours > 0) {
        timeString += hours + " ชั่วโมง ";
      }
      if (minutes > 0 || hours > 0) {
        timeString += minutes + " นาที ";
      }
      timeString += seconds + " วินาที";
      return timeString;
    }

    // ฟังก์ชันแปลง pace (นาที/กม.) ให้เป็นรูปแบบ "m:ss"
    function formatPace(pace) {
      const paceMinutes = Math.floor(pace);
      const paceSeconds = Math.round((pace - paceMinutes) * 60);
      const secondsStr = paceSeconds < 10 ? "0" + paceSeconds : paceSeconds;
      return paceMinutes + ":" + secondsStr;
    }

    function calculateRacePredict() {
      // รับค่า LT Pace จาก input (นาที และ วินาที)
      const ltMinutes = parseInt(document.getElementById("ltMinutes").value, 10);
      const ltSeconds = parseInt(document.getElementById("ltSeconds").value, 10);
      const targetDistance = parseFloat(document.getElementById("distance").value);

      if (isNaN(ltMinutes) || isNaN(ltSeconds) || isNaN(targetDistance)) {
        document.getElementById("result").innerHTML = "กรุณากรอกข้อมูลให้ครบถ้วน";
        return;
      }
      
      // คำนวณ LT Pace เป็นวินาทีต่อกม.
      const ltTotalSec = ltMinutes * 60 + ltSeconds;
      
      // กำหนด segments ที่มีช่วงเวลา (นาที) และเปอร์เซ็นต์ LT Pace
      const segments = [
        { duration: 10, percent: 108 },
        { duration: 30, percent: 100 },
        { duration: 120, percent: 90 },
        { duration: 180, percent: 85 }
      ];
      
      let totalTimeMinutes = 0;         // เวลาที่ใช้ทั้งหมด (นาที)
      let remainingDistance = targetDistance;  // ระยะทางที่เหลือ
      let segmentBreakdown = [];         // เก็บข้อมูลของแต่ละ segment

      // ฟังก์ชันคำนวณ adjusted pace (นาที/กม.) จากเปอร์เซ็นต์
      function adjustedPace(percent) {
        // adjusted pace (sec/km) = LT Pace (sec/km) × (100/percent)
        return (ltTotalSec * (100 / percent)) / 60; // นาที/กม.
      }
      
      // คำนวณจาก segments ที่กำหนด
      for (let i = 0; i < segments.length; i++) {
        const seg = segments[i];
        const segDuration = seg.duration; // นาที
        const pace = adjustedPace(seg.percent);  // นาที/กม. สำหรับ segment นี้
        const segDistance = segDuration / pace;    // กม.
        
        if (segDistance < remainingDistance) {
          totalTimeMinutes += segDuration;
          remainingDistance -= segDistance;
          segmentBreakdown.push({ distance: segDistance, pace: pace });
        } else {
          // หาก segment นี้วิ่งได้เกินที่ต้องการ ให้ใช้แค่ส่วนที่พอเพียง
          const timeNeeded = remainingDistance * pace;
          totalTimeMinutes += timeNeeded;
          segmentBreakdown.push({ distance: remainingDistance, pace: pace });
          remainingDistance = 0;
          break;
        }
      }
      
      // ถ้ายังเหลือระยะทาง ให้ใช้ความเร็วที่ 70% สำหรับส่วนที่เหลือ
      if (remainingDistance > 0) {
        const pace70 = adjustedPace(70);
        const timeForRemaining = remainingDistance * pace70;
        totalTimeMinutes += timeForRemaining;
        segmentBreakdown.push({ distance: remainingDistance, pace: pace70 });
        remainingDistance = 0;
      }
      
      // คำนวณเวลารวมเป็นวินาที
      const totalTimeSec = Math.round(totalTimeMinutes * 60);
      const overallTimeStr = formatTime(totalTimeSec);
      
      // คำนวณ pace เฉลี่ย (นาที/กม.) จากเวลารวมและระยะทางเป้าหมาย
      const avgPace = totalTimeMinutes / targetDistance;
      const avgPaceStr = formatPace(avgPace);
      
      // แสดงผลลัพธ์รวม (เวลาที่คาดว่าจะทำได้ พร้อม pace เฉลี่ย)
      let resultHTML = "<p><strong>เวลาที่คาดว่าจะทำได้:</strong> " + overallTimeStr +
                       " (Pace เฉลี่ย: " + avgPaceStr + " นาที/กม.)</p>";
      document.getElementById("result").innerHTML = resultHTML;
      
      // แสดงรายละเอียดการวิ่งในแต่ละ segment
      // เรียงลำดับ segment จาก pace ที่ช้าก่อน (นาที/กม. มากที่สุด)
      segmentBreakdown.sort((a, b) => b.pace - a.pace);
      
      let breakdownHTML = "<h3>รายละเอียดการวิ่งตาม Pace:</h3><ul class='segment-list'>";
      segmentBreakdown.forEach(function(seg) {
        // แสดงระยะทางเป็นเลขจำนวนเต็ม (ปัดเศษ)
        const distanceInt = Math.round(seg.distance);
        const paceStr = formatPace(seg.pace);
        breakdownHTML += "<li>" + distanceInt + " กม. (" + paceStr + " นาที/กม.)</li>";
      });
      breakdownHTML += "</ul>";
      document.getElementById("breakdown").innerHTML = breakdownHTML;
    }
  </script>
</body>
</html>
