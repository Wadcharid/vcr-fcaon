<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Running Coach (Advance)</title>
  <style>
    /* รีเซ็ตเบื้องต้น */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: sans-serif;
      background: #f6f8fa;
      color: #333;
      line-height: 1.5;
      padding: 1rem;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    header p {
      color: #666;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 2rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    h2 {
      margin-bottom: 1rem;
      text-align: center;
      color: #007BFF;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .form-group select,
    .form-group input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9rem;
      font-family: inherit;
    }

    .btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      margin-top: 1.5rem;
      background: #007BFF;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .btn:hover {
      background: #0056b3;
    }

    .result {
      margin-top: 2rem;
    }

    .plan-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    .plan-table thead {
      background: #f0f0f0;
    }

    .plan-table th,
    .plan-table td {
      padding: 0.75rem;
      border: 1px solid #ddd;
      text-align: center;
    }

    .plan-table th {
      font-weight: 700;
    }

    .no-plan {
      text-align: center;
      color: #999;
      margin-top: 1rem;
    }

    /* เพิ่มสไตล์เล็กน้อยสำหรับ Workout Type */
    .workout-type {
      font-size: 0.85rem;
      color: #555;
      display: block; /* ให้ขึ้นบรรทัดใหม่ */
      margin-top: 0.25rem;
    }

    @media (max-width: 600px) {
      .form-group label,
      .form-group input,
      .form-group select {
        font-size: 0.85rem;
      }

      h2 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>My Running Coach (Advance)</h1>
    <p>ตัวอย่างโค้ชวิ่งอัตโนมัติที่เพิ่มรายละเอียดการซ้อมและการ Taper</p>
  </header>

  <div class="container">
    <h2>กรอกข้อมูลเพื่อสร้างตารางซ้อม</h2>
    <!-- ฟอร์มกรอกข้อมูลต่าง ๆ -->
    <div class="form-group">
      <label for="distanceGoal">ระยะทางเป้าหมาย (Event ที่ตั้งใจวิ่ง):</label>
      <select id="distanceGoal">
        <option value="5">5K</option>
        <option value="10">10K</option>
        <option value="21">Half Marathon (21K)</option>
        <option value="42">Full Marathon (42K)</option>
      </select>
    </div>

    <div class="form-group">
      <label for="trainingWeeks">จำนวนสัปดาห์ที่ต้องการเตรียมตัว (เช่น 8):</label>
      <input type="number" id="trainingWeeks" placeholder="8" min="1" value="8">
    </div>

    <div class="form-group">
      <label for="runDaysPerWeek">จำนวนวันวิ่งต่อสัปดาห์ (1-7):</label>
      <input type="number" id="runDaysPerWeek" placeholder="3" min="1" max="7" value="3">
    </div>

    <div class="form-group">
      <label for="currentMileage">ไมล์สะสมต่อสัปดาห์ (กม.) ในปัจจุบัน:</label>
      <input type="number" id="currentMileage" placeholder="10" min="0" value="10">
    </div>

    <button class="btn" id="generatePlanBtn">สร้างตารางซ้อม</button>

    <!-- ส่วนแสดงผลตารางซ้อม -->
    <div class="result" id="resultContainer">
      <!-- ตารางหรือข้อความจะแสดงในนี้ด้วย JS -->
    </div>
  </div>

  <!-- JavaScript ส่วนประมวลผล -->
  <script>
    const generatePlanBtn = document.getElementById('generatePlanBtn');
    const resultContainer = document.getElementById('resultContainer');

    // ฟังก์ชั่นจำลองการคำนวณตารางซ้อม + Taper + Workout Type
    function generateTrainingPlan(distanceGoal, totalWeeks, runDays, currentMileage) {
      // สัปดาห์ Taper สุดท้าย 2 สัปดาห์ (ถ้า totalWeeks >= 4)
      // ตัวอย่างเงื่อนไข: ถ้า totalWeeks >= 4
      //    - สัปดาห์รองสุดท้าย (week = totalWeeks - 1): 80% ของสัปดาห์ก่อนหน้า
      //    - สัปดาห์สุดท้าย (week = totalWeeks): 60% ของสัปดาห์ก่อนหน้า
      // ทั้งนี้ถ้าสัปดาห์น้อยกว่า 4 อาจจะไม่ทำ Taper หรือปรับตามต้องการ

      const plan = [];
      let weeklyMileage = currentMileage; // เริ่มจากค่าปัจจุบัน

      for (let w = 1; w <= totalWeeks; w++) {
        let roundMileage;

        if (w > 1) {
          // ก่อนเข้าสู่ช่วง Taper
          if (totalWeeks >= 4 && (w === totalWeeks - 1 || w === totalWeeks)) {
            // 2 สัปดาห์สุดท้าย (Taper)
            if (w === totalWeeks - 1) {
              // Taper 80%
              weeklyMileage = weeklyMileage * 0.8;
            } else if (w === totalWeeks) {
              // Taper 60%  
              weeklyMileage = weeklyMileage * 0.6;
            }
          } else {
            // ไม่ใช่ Taper -> +10%
            weeklyMileage = weeklyMileage * 1.1;
          }
        }

        roundMileage = Math.round(weeklyMileage);

        // สร้างตารางรายวัน (Day Distances) พร้อม "ประเภทการซ้อม (Workout Type)"
        // ตัวอย่างการแบ่งประเภทถ้าวิ่ง 3 วัน:
        //   - Day1: Easy
        //   - Day2: Interval/Tempo
        //   - Day3: Long Run
        // ถ้าวิ่งมากกว่านี้ อาจกำหนด pattern หลายแบบ หรือสร้าง logic ซับซ้อนขึ้น

        const dayData = []; // เก็บ { distance, workoutType }

        // สมมติรูปแบบการซ้อมตามจำนวนวัน
        // ตัวอย่าง pattern ง่าย ๆ: [Easy, Interval, Easy, Tempo, Easy, Long Run, Rest?] ...
        // สามารถปรับให้สอดคล้องกับ runDays ได้ตามต้องการ
        const workoutPattern = generateWorkoutPattern(runDays);

        // กระจายระยะทางลงในแต่ละวันตามสัดส่วน (ตัวอย่าง)
        // เช่น ถ้าวิ่ง 3 วัน อาจแบ่ง 25%, 30%, 45%
        // หรือถ้าวิ่ง 4 วันอาจแบ่ง 20%, 25%, 20%, 35%, เป็นต้น
        const ratioArr = getDistanceRatio(runDays);

        let totalRatioSum = 0;
        ratioArr.forEach((r) => (totalRatioSum += r));

        for (let d = 0; d < runDays; d++) {
          const dist = Math.round(roundMileage * (ratioArr[d] / totalRatioSum));
          dayData.push({
            distance: dist,
            workoutType: workoutPattern[d] || "Easy Run", // fallback ถ้า pattern ไม่พอ
          });
        }

        plan.push({
          weekNum: w,
          totalMileage: roundMileage,
          days: dayData,
        });
      }

      return plan;
    }

    // สร้าง pattern ง่าย ๆ ของประเภทการซ้อม (Workout Type) ตามจำนวนวันวิ่ง
    function generateWorkoutPattern(runDays) {
      // ตัวอย่างง่าย ๆ สำหรับ 3 วัน
      // จะได้ ["Easy Run", "Interval/Tempo", "Long Run"]

      // ถ้าอยากให้รองรับได้หลาย ๆ วัน อาจกำหนดเงื่อนไขว่า
      //   1: Easy
      //   2: Interval
      //   3: Easy
      //   4: Tempo
      //   5: Long
      //   6: Recovery
      //   7: Rest
      // หรือแล้วแต่จะออกแบบ
      // ในตัวอย่างนี้จะยกตัวอย่างสั้น ๆ
      const pattern3 = ["Easy Run", "Interval/Tempo", "Long Run"];
      const pattern4 = ["Easy Run", "Interval", "Tempo", "Long Run"];
      const pattern5 = ["Easy Run", "Interval", "Easy Run", "Tempo", "Long Run"];
      const pattern6 = ["Easy Run", "Interval", "Tempo", "Easy Run", "Long Run", "Recovery Run"];
      const pattern7 = ["Easy Run", "Interval", "Easy Run", "Tempo", "Long Run", "Recovery Run", "Rest Day"];

      switch (runDays) {
        case 1:
          return ["Long Run"];
        case 2:
          return ["Easy Run", "Long Run"];
        case 3:
          return pattern3;
        case 4:
          return pattern4;
        case 5:
          return pattern5;
        case 6:
          return pattern6;
        case 7:
          return pattern7;
        default:
          return pattern3; // fallback
      }
    }

    // กำหนดสัดส่วนการแบ่งระยะทางในแต่ละวัน (Total = 1.0)
    // ตัวอย่าง: ถ้าวิ่ง 3 วัน -> [0.25, 0.3, 0.45]
    function getDistanceRatio(runDays) {
      // สามารถปรับได้ตามหลักการซ้อมจริงหรือตามใจชอบ
      switch (runDays) {
        case 1:
          return [1.0];
        case 2:
          return [0.4, 0.6];
        case 3:
          return [0.25, 0.3, 0.45];
        case 4:
          return [0.2, 0.2, 0.25, 0.35];
        case 5:
          return [0.15, 0.2, 0.15, 0.2, 0.3];
        case 6:
          return [0.15, 0.15, 0.15, 0.2, 0.2, 0.15];
        case 7:
          return [0.1, 0.15, 0.15, 0.2, 0.2, 0.15, 0.05];
        default:
          return [0.25, 0.3, 0.45];
      }
    }

    // ฟังก์ชั่นแสดงผลตาราง
    function renderPlan(plan, runDays) {
      if (plan.length === 0) {
        return '<p class="no-plan">ไม่มีข้อมูลตารางซ้อม</p>';
      }

      let html = `
        <table class="plan-table">
          <thead>
            <tr>
              <th>สัปดาห์</th>
              <th>รวม (กม.)</th>
      `;
      // สร้างหัวตารางย่อยสำหรับวันวิ่ง
      for (let d = 1; d <= runDays; d++) {
        html += `<th>Day ${d}</th>`;
      }
      html += `</tr></thead><tbody>`;

      // สร้างบรรทัดของแต่ละสัปดาห์
      plan.forEach((week) => {
        html += `
          <tr>
            <td>W${week.weekNum}</td>
            <td>${week.totalMileage}</td>
        `;
        // ใส่ข้อมูลไมล์+ประเภทการซ้อมในแต่ละวัน
        week.days.forEach((day) => {
          html += `
            <td>
              ${day.distance} กม.
              <span class="workout-type">${day.workoutType}</span>
            </td>
          `;
        });
        // ถ้า day น้อยกว่าจำนวน runDays ที่ตั้งไว้ (เช่นบางกรณี logic ไม่ครอบคลุม) ให้เติมคอลัมน์เปล่า
        if (week.days.length < runDays) {
          for (let i = week.days.length; i < runDays; i++) {
            html += `<td> - </td>`;
          }
        }
        html += `</tr>`;
      });

      html += `</tbody></table>`;
      return html;
    }

    // เมื่อคลิกปุ่ม "สร้างตารางซ้อม"
    generatePlanBtn.addEventListener('click', () => {
      const distanceGoal = parseInt(document.getElementById('distanceGoal').value, 10);
      const trainingWeeks = parseInt(document.getElementById('trainingWeeks').value, 10);
      const runDaysPerWeek = parseInt(document.getElementById('runDaysPerWeek').value, 10);
      const currentMileage = parseFloat(document.getElementById('currentMileage').value);

      // เรียกฟังก์ชั่นสร้างตารางซ้อม
      const plan = generateTrainingPlan(distanceGoal, trainingWeeks, runDaysPerWeek, currentMileage);
      // แสดงผล
      resultContainer.innerHTML = renderPlan(plan, runDaysPerWeek);
    });
  </script>
</body>
</html>
